{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 27, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gabri/Documents/project/doc/next/user-management-app/lib/csvHandler.js"],"sourcesContent":["\r\nconst fs = require('fs');\r\nconst path = require('path');\r\n\r\nconst CSV_FILE = path.join(process.cwd(), 'data', 'users.csv');\r\n\r\nconst ensureDataDirectory = () => {\r\n  const dataDir = path.join(process.cwd(), 'data');\r\n  if (!fs.existsSync(dataDir)) {\r\n    fs.mkdirSync(dataDir, { recursive: true });\r\n  }\r\n};\r\n\r\nconst parseCSV = (content) => {\r\n  const lines = content.split('\\n').filter(line => line.trim());\r\n  if (lines.length <= 1) return []; // Only headers or empty\r\n  \r\n  const headers = lines[0].split(';').map(h => h.trim());\r\n  const results = [];\r\n  \r\n  for (let i = 1; i < lines.length; i++) {\r\n    const values = lines[i].split(';');\r\n    const row = {};\r\n    \r\n    headers.forEach((header, index) => {\r\n      row[header] = values[index] ? values[index].trim() : '';\r\n    });\r\n    \r\n    if (row.ID && row.UID && row.ID !== 'ID') {\r\n      results.push({\r\n        id: row.ID,\r\n        uid: row.UID,\r\n        first_name: row['First Name'],\r\n        last_name: row['Last Name'],\r\n        username: row.Username,\r\n        email: row.Email,\r\n        phone_number: row['Phone Number'],\r\n        date_of_birth: row['Date of Birth'],\r\n        company: row.Company || '',\r\n        created_at: row['Created At'] || new Date().toISOString()\r\n      });\r\n    }\r\n  }\r\n  \r\n  return results;\r\n};\r\n\r\nconst initializeCSV = async () => {\r\n  try {\r\n    ensureDataDirectory();\r\n    \r\n    if (!fs.existsSync(CSV_FILE)) {\r\n      const headerRow = 'ID;UID;First Name;Last Name;Username;Email;Phone Number;Date of Birth;Company;Created At\\n';\r\n      fs.writeFileSync(CSV_FILE, headerRow, 'utf8');\r\n      console.log('CSV file initialized at:', CSV_FILE);\r\n    }\r\n  } catch (error) {\r\n    console.error('Error initializing CSV:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst readCSV = async () => {\r\n  try {\r\n    if (!fs.existsSync(CSV_FILE)) {\r\n      return [];\r\n    }\r\n\r\n    const content = fs.readFileSync(CSV_FILE, 'utf8');\r\n    const records = parseCSV(content);\r\n    \r\n    console.log(`Read ${records.length} records from CSV`);\r\n    return records;\r\n  } catch (error) {\r\n    console.error('Error reading CSV:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\nconst writeCSV = async (records) => {\r\n  try {\r\n    ensureDataDirectory();\r\n    \r\n    console.log(`Writing ${records.length} records to CSV...`);\r\n    \r\n    // Create header row\r\n    const headers = ['ID', 'UID', 'First Name', 'Last Name', 'Username', 'Email', 'Phone Number', 'Date of Birth', 'Company', 'Created At'];\r\n    const headerRow = headers.join(';') + '\\n';\r\n    \r\n    // Create data rows\r\n    const dataRows = records.map(record => {\r\n      return [\r\n        record.id || '',\r\n        record.uid || '',\r\n        record.first_name || '',\r\n        record.last_name || '',\r\n        record.username || '',\r\n        record.email || '',\r\n        record.phone_number || '',\r\n        record.date_of_birth || '',\r\n        record.company || '',\r\n        record.created_at || new Date().toISOString()\r\n      ].join(';');\r\n    }).join('\\n');\r\n    \r\n    const fullContent = headerRow + dataRows;\r\n    fs.writeFileSync(CSV_FILE, fullContent, 'utf8');\r\n    \r\n    console.log(`Successfully written ${records.length} records to CSV`);\r\n    return records.length;\r\n  } catch (error) {\r\n    console.error('Error writing CSV:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst appendToCSV = async (user) => {\r\n  try {\r\n    ensureDataDirectory();\r\n    \r\n    // Read existing records first\r\n    const existingRecords = await readCSV();\r\n    console.log(`Found ${existingRecords.length} existing records`);\r\n    \r\n    // Generate new ID - find the highest existing ID and add 1\r\n    const maxId = existingRecords.length > 0 \r\n      ? Math.max(...existingRecords.map(r => parseInt(r.id) || 0))\r\n      : 0;\r\n    \r\n    const newId = maxId + 1;\r\n    \r\n    const newUser = {\r\n      id: newId.toString(),\r\n      uid: user.uid,\r\n      first_name: user.first_name || '',\r\n      last_name: user.last_name || '',\r\n      username: user.username || '',\r\n      email: user.email || '',\r\n      phone_number: user.phone_number || '',\r\n      date_of_birth: user.date_of_birth || '',\r\n      company: user.company || '',\r\n      created_at: new Date().toISOString()\r\n    };\r\n    \r\n    console.log('Appending new user with ID:', newId);\r\n    \r\n    // Add new user to existing records\r\n    const allRecords = [...existingRecords, newUser];\r\n    \r\n    // Write all records back to file\r\n    await writeCSV(allRecords);\r\n    \r\n    return newUser;\r\n  } catch (error) {\r\n    console.error('Error appending to CSV:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst addUser = async (user) => {\r\n  try {\r\n    await initializeCSV();\r\n    const records = await readCSV();\r\n    \r\n    // Generate unique ID - find the highest existing ID and increment\r\n    const maxId = records.length > 0 \r\n      ? Math.max(...records.map(r => parseInt(r.id) || 0)) \r\n      : 0;\r\n    \r\n    const newUser = {\r\n      id: (maxId + 1).toString(),\r\n      uid: user.uid || user.id || `user-${Date.now()}`, // Handle both uid and id from API\r\n      first_name: user.first_name,\r\n      last_name: user.last_name,\r\n      username: user.username,\r\n      email: user.email,\r\n      phone_number: user.phone_number,\r\n      date_of_birth: user.date_of_birth\r\n    };\r\n    \r\n    // Add new user to existing records\r\n    records.push(newUser);\r\n    \r\n    // Write ALL records back to CSV (existing + new)\r\n    await writeCSV(records);\r\n    return newUser;\r\n  } catch (error) {\r\n    console.error('Error adding user to CSV:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n\r\nconst updateUser = async (id, updatedUser) => {\r\n  try {\r\n    const records = await readCSV();\r\n    console.log(`Looking for user with ID: ${id} in ${records.length} records`);\r\n    \r\n    const index = records.findIndex(record => record.id === id.toString());\r\n    \r\n    if (index === -1) {\r\n      console.log('Available IDs:', records.map(r => r.id));\r\n      throw new Error(`User with ID ${id} not found. Available IDs: ${records.map(r => r.id).join(', ')}`);\r\n    }\r\n    \r\n    console.log(`Found user at index ${index}:`, records[index]);\r\n    \r\n    records[index] = { \r\n      ...records[index], \r\n      ...updatedUser,\r\n      id: records[index].id, // Preserve original ID\r\n      created_at: records[index].created_at // Preserve creation date\r\n    };\r\n    \r\n    console.log('Updated user:', records[index]);\r\n    \r\n    await writeCSV(records);\r\n    console.log(`Successfully updated user with ID: ${id}`);\r\n    return records[index];\r\n  } catch (error) {\r\n    console.error('Error updating user:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst deleteUser = async (id) => {\r\n  try {\r\n    const records = await readCSV();\r\n    console.log(`Looking for user with ID: ${id} in ${records.length} records`);\r\n    \r\n    const initialLength = records.length;\r\n    const filteredRecords = records.filter(record => record.id !== id.toString());\r\n    \r\n    if (filteredRecords.length === initialLength) {\r\n      console.log('Available IDs:', records.map(r => r.id));\r\n      throw new Error(`User with ID ${id} not found. Available IDs: ${records.map(r => r.id).join(', ')}`);\r\n    }\r\n    \r\n    console.log(`Found user to delete. Records before: ${initialLength}, after: ${filteredRecords.length}`);\r\n    \r\n    // Reassign IDs to maintain sequence\r\n    const reindexedRecords = filteredRecords.map((record, index) => ({\r\n      ...record,\r\n      id: (index + 1).toString() // Reset IDs to sequential order\r\n    }));\r\n    \r\n    await writeCSV(reindexedRecords);\r\n    console.log(`Successfully deleted user with ID: ${id}`);\r\n    return true;\r\n  } catch (error) {\r\n    console.error('Error deleting user:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst getStats = async () => {\r\n  try {\r\n    const records = await readCSV();\r\n    return {\r\n      total: records.length,\r\n      lastUpdated: records.length > 0 ? \r\n        new Date(Math.max(...records.map(r => new Date(r.created_at || 0)))) : \r\n        null\r\n    };\r\n  } catch (error) {\r\n    console.error('Error getting stats:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  initializeCSV,\r\n  readCSV,\r\n  addUser,\r\n  appendToCSV,\r\n  updateUser,\r\n  deleteUser,\r\n  getStats,\r\n  writeCSV\r\n};"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/gabri/Documents/project/doc/next/user-management-app/pages/api/save.js"],"sourcesContent":["import { addUser, initializeCSV } from '../../lib/csvHandler';\r\n\r\nexport default async function handler(req, res) {\r\n  if (req.method !== 'POST') {\r\n    return res.status(405).json({ message: 'Method not allowed' });\r\n  }\r\n\r\n  try {\r\n    await initializeCSV();\r\n    const user = req.body;\r\n    const savedUser = await addUser(user);\r\n    res.status(201).json(savedUser);\r\n  } catch (error) {\r\n    res.status(500).json({ message: 'Error saving user', error: error.message });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAqB;IAC9D;IAEA,IAAI;QACF,MAAM,IAAA,2HAAa;QACnB,MAAM,OAAO,IAAI,IAAI;QACrB,MAAM,YAAY,MAAM,IAAA,qHAAO,EAAC;QAChC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;IACvB,EAAE,OAAO,OAAO;QACd,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;YAAqB,OAAO,MAAM,OAAO;QAAC;IAC5E;AACF","debugId":null}}]
}